<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Reading Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Quicksand', 'Nunito', 'Rounded', sans-serif;
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
        }

        .bg-animated {
            position: fixed;
            inset: 0;
            background: linear-gradient(to bottom right, #e9d5ff, #fbcfe8, #dbeafe);
            z-index: 0;
        }

        .blob {
            position: absolute;
            border-radius: 50%;
            mix-blend-mode: multiply;
            filter: blur(60px);
            opacity: 0.3;
        }

        .blob-1 {
            top: 0;
            left: 0;
            width: 24rem;
            height: 24rem;
            background: #d8b4fe;
            animation: blob 7s infinite;
        }

        .blob-2 {
            top: 0;
            right: 0;
            width: 24rem;
            height: 24rem;
            background: #f9a8d4;
            animation: blob 7s infinite;
            animation-delay: 2s;
        }

        .blob-3 {
            bottom: 0;
            left: 50%;
            width: 24rem;
            height: 24rem;
            background: #93c5fd;
            animation: blob 7s infinite;
            animation-delay: 4s;
        }

        .blob-4 {
            bottom: 0;
            right: 0;
            width: 24rem;
            height: 24rem;
            background: #fecaca;
            animation: blob 7s infinite;
            animation-delay: 6s;
        }

        @keyframes blob {
            0%, 100% {
                transform: translate(0px, 0px) scale(1);
            }
            33% {
                transform: translate(30px, -50px) scale(1.1);
            }
            66% {
                transform: translate(-20px, 20px) scale(0.9);
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .fade-in { animation: fadeIn 0.3s ease-out; }
        .slide-down { animation: slideDown 0.4s ease-out; }

        .container {
            position: relative;
            z-index: 10;
            padding: 1.5rem;
            max-width: 80rem;
            margin: 0 auto;
        }

        .grid { display: grid; }
        .grid-cols-1 { grid-template-columns: repeat(1, minmax(0, 1fr)); }
        .grid-cols-2 { grid-template-columns: repeat(2, minmax(0, 1fr)); }
        .grid-cols-7 { grid-template-columns: repeat(7, minmax(0, 1fr)); }
        .gap-2 { gap: 0.5rem; }
        .gap-3 { gap: 0.75rem; }
        .gap-4 { gap: 1rem; }
        .gap-6 { gap: 1.5rem; }

        @media (min-width: 768px) {
            .md\\:grid-cols-2 { grid-template-columns: repeat(2, minmax(0, 1fr)); }
            .md\\:grid-cols-3 { grid-template-columns: repeat(3, minmax(0, 1fr)); }
        }

        .card {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            padding: 1.5rem;
            border-radius: 1.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: all 0.3s;
        }

        .card:hover {
            box-shadow: 0 20px 25px rgba(0, 0, 0, 0.15);
            transform: scale(1.02);
        }

        .btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: 0.75rem 1.5rem;
            border-radius: 9999px;
            font-weight: 600;
            transition: all 0.3s;
            cursor: pointer;
            border: none;
            font-family: inherit;
        }

        .btn-primary {
            background: linear-gradient(to right, #c084fc, #f472b6);
            color: white;
        }

        .btn-primary:hover {
            box-shadow: 0 20px 25px rgba(0, 0, 0, 0.15);
            transform: scale(1.05);
        }

        .tab-btn {
            width: 100%;
            padding: 1.5rem;
            border-radius: 1rem;
            font-weight: 700;
            transition: all 0.3s;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
            min-height: 140px;
            border: none;
            cursor: pointer;
            font-family: inherit;
        }

        .tab-btn.inactive {
            background: rgba(255, 255, 255, 0.8);
            color: #374151;
        }

        .tab-btn.inactive:hover {
            background: white;
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
        }

        .tab-btn.active-reading {
            background: linear-gradient(to bottom right, #c084fc, #f472b6);
            color: white;
            box-shadow: 0 20px 25px rgba(0, 0, 0, 0.15);
            transform: scale(1.05);
        }

        .tab-btn.active-tbr {
            background: linear-gradient(to bottom right, #60a5fa, #c084fc);
            color: white;
            box-shadow: 0 20px 25px rgba(0, 0, 0, 0.15);
            transform: scale(1.05);
        }

        .tab-btn.active-completed {
            background: linear-gradient(to bottom right, #f472b6, #f87171);
            color: white;
            box-shadow: 0 20px 25px rgba(0, 0, 0, 0.15);
            transform: scale(1.05);
        }

        .badge {
            padding: 0.25rem 1rem;
            border-radius: 9999px;
            font-size: 0.875rem;
            font-weight: 700;
        }

        .input {
            border: 2px solid #e9d5ff;
            border-radius: 1rem;
            padding: 0.75rem 1rem;
            width: 100%;
            font-family: inherit;
            transition: border-color 0.2s;
        }

        .input:focus {
            outline: none;
            border-color: #c084fc;
        }

        .hidden { display: none; }

        .flex { display: flex; }
        .flex-col { flex-direction: column; }
        .items-center { align-items: center; }
        .justify-center { justify-content: center; }
        .justify-between { justify-content: space-between; }
        .text-center { text-align: center; }

        .mb-3 { margin-bottom: 0.75rem; }
        .mb-4 { margin-bottom: 1rem; }
        .mb-6 { margin-bottom: 1.5rem; }
        .mb-8 { margin-bottom: 2rem; }
        .mt-1 { margin-top: 0.25rem; }
        .mt-4 { margin-top: 1rem; }
        .mt-6 { margin-top: 1.5rem; }
        .p-2 { padding: 0.5rem; }
        .p-4 { padding: 1rem; }
        .p-5 { padding: 1.25rem; }
        .p-6 { padding: 1.5rem; }
        .px-3 { padding-left: 0.75rem; padding-right: 0.75rem; }
        .px-4 { padding-left: 1rem; padding-right: 1rem; }
        .px-6 { padding-left: 1.5rem; padding-right: 1.5rem; }
        .py-1 { padding-top: 0.25rem; padding-bottom: 0.25rem; }
        .py-2 { padding-top: 0.5rem; padding-bottom: 0.5rem; }
        .py-3 { padding-top: 0.75rem; padding-bottom: 0.75rem; }
        .py-4 { padding-top: 1rem; padding-bottom: 1rem; }
        .py-8 { padding-top: 2rem; padding-bottom: 2rem; }

        .rounded-xl { border-radius: 0.75rem; }
        .rounded-2xl { border-radius: 1rem; }
        .rounded-3xl { border-radius: 1.5rem; }
        .rounded-full { border-radius: 9999px; }

        .shadow-lg { box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1); }
        .shadow-xl { box-shadow: 0 20px 25px rgba(0, 0, 0, 0.15); }

        .text-sm { font-size: 0.875rem; }
        .text-lg { font-size: 1.125rem; }
        .text-xl { font-size: 1.25rem; }
        .text-2xl { font-size: 1.5rem; }
        .text-4xl { font-size: 2.25rem; }

        .font-medium { font-weight: 500; }
        .font-semibold { font-weight: 600; }
        .font-bold { font-weight: 700; }

        .text-white { color: white; }
        .text-gray-600 { color: #4b5563; }
        .text-gray-700 { color: #374151; }
        .text-gray-800 { color: #1f2937; }
        .text-purple-600 { color: #9333ea; }
        .text-blue-600 { color: #2563eb; }
        .text-pink-600 { color: #db2777; }

        .bg-purple-100 { background: #f3e8ff; }
        .bg-purple-200 { background: #e9d5ff; }
        .bg-blue-100 { background: #dbeafe; }
        .bg-pink-100 { background: #fce7f3; }
        .bg-gray-100 { background: #f3f4f6; }
        .bg-gray-200 { background: #e5e7eb; }
        .bg-red-50 { background: #fef2f2; }

        .gradient-text {
            background: linear-gradient(to right, #9333ea, #db2777, #2563eb);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .gradient-purple-pink {
            background: linear-gradient(to right, #c084fc, #f472b6);
        }

        .gradient-blue-purple {
            background: linear-gradient(to right, #60a5fa, #c084fc);
        }

        .gradient-pink-red {
            background: linear-gradient(to right, #f472b6, #f87171);
        }

        .gradient-green {
            background: linear-gradient(to bottom right, #4ade80, #10b981);
        }

        .icon-box {
            background: linear-gradient(to bottom right, #c084fc, #f472b6);
            padding: 0.75rem;
            border-radius: 1rem;
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
        }

        .title {
            font-size: 2.25rem;
            font-weight: 700;
            background: linear-gradient(to right, #9333ea, #db2777, #2563eb);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .book-card {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            padding: 1.25rem;
            border-radius: 1.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(192, 132, 252, 0.3);
            transition: all 0.3s;
        }

        .book-card:hover {
            box-shadow: 0 20px 25px rgba(0, 0, 0, 0.15);
            transform: scale(1.05);
            border-color: #c084fc;
        }

        .delete-btn {
            color: #f87171;
            background: transparent;
            border: none;
            padding: 0.5rem;
            border-radius: 9999px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .delete-btn:hover {
            color: #dc2626;
            background: #fef2f2;
        }

        .calendar-day {
            aspect-ratio: 1;
            border-radius: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.875rem;
            font-weight: 600;
            transition: all 0.3s;
            cursor: pointer;
            border: none;
            font-family: inherit;
        }

        .calendar-day.today {
            background: linear-gradient(to bottom right, #c084fc, #f472b6);
            color: white;
            box-shadow: 0 0 0 2px #e9d5ff;
        }

        .calendar-day.read {
            background: linear-gradient(to bottom right, #4ade80, #10b981);
            color: white;
        }

        .calendar-day.read:hover {
            transform: scale(1.1);
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
        }

        .calendar-day.empty {
            background: #f3f4f6;
            color: #4b5563;
        }

        .calendar-day.empty:hover {
            background: #e5e7eb;
            transform: scale(1.05);
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            padding: 1.5rem;
            border-radius: 1.5rem;
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s;
        }

        .stat-card:hover {
            box-shadow: 0 20px 25px rgba(0, 0, 0, 0.15);
            transform: scale(1.05);
        }

        .stat-card.purple { border-left: 4px solid #c084fc; }
        .stat-card.blue { border-left: 4px solid #60a5fa; }
        .stat-card.pink { border-left: 4px solid #f472b6; }
        .stat-card.red { border-left: 4px solid #f87171; }
        .stat-card.orange { border-left: 4px solid #fb923c; }
        .stat-card.emerald { border-left: 4px solid #10b981; }

        select, input[type="date"] {
            font-family: inherit;
            border: none;
            background: transparent;
            cursor: pointer;
        }

        select:focus, input[type="date"]:focus {
            outline: none;
        }

        input[type="date"] {
            border: 1px solid #e9d5ff;
            border-radius: 0.75rem;
            padding: 0.25rem 0.75rem;
        }

        input[type="date"]:focus {
            border-color: #c084fc;
        }

        .all-books-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem;
            border-radius: 0.75rem;
            background: linear-gradient(to right, #faf5ff, #fce7f3);
            transition: all 0.3s;
            margin-bottom: 0.5rem;
        }

        .all-books-item:hover {
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .status-badge {
            padding: 0.5rem 1rem;
            border-radius: 9999px;
            font-size: 0.875rem;
            font-weight: 700;
            color: white;
        }

        .space-y-2 > * + * {
            margin-top: 0.5rem;
        }

        .min-w-150 {
            min-width: 150px;
        }

        .italic {
            font-style: italic;
        }

        .cursor-pointer {
            cursor: pointer;
        }

        @media (max-width: 767px) {
            .title {
                font-size: 1.875rem;
            }
        }
    </style>
</head>
<body>
    <div class="bg-animated">
        <div class="blob blob-1"></div>
        <div class="blob blob-2"></div>
        <div class="blob blob-3"></div>
        <div class="blob blob-4"></div>
    </div>

    <div class="container">
        <!-- Tabs -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6 fade-in" id="categoryTabs">
            <div>
                <button onclick="toggleTab('reading')" id="readingTab" class="tab-btn inactive">
                    <svg width="32" height="32" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
                    </svg>
                    <span class="text-lg">Currently Reading</span>
                    <span class="badge bg-purple-100 text-purple-600" id="readingCount">0 books</span>
                </button>
                <div id="readingList" class="mt-4 hidden"></div>
            </div>
            
            <div>
                <button onclick="toggleTab('tbr')" id="tbrTab" class="tab-btn inactive">
                    <svg width="32" height="32" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                    </svg>
                    <span class="text-lg">To Be Read</span>
                    <span class="badge bg-blue-100 text-blue-600" id="tbrCount">0 books</span>
                </button>
                <div id="tbrList" class="mt-4 hidden"></div>
            </div>
            
            <div>
                <button onclick="toggleTab('completed')" id="completedTab" class="tab-btn inactive">
                    <svg width="32" height="32" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path>
                    </svg>
                    <span class="text-lg">Completed Books</span>
                    <span class="badge bg-pink-100 text-pink-600" id="completedCount">0 books</span>
                </button>
                <div id="completedList" class="mt-4 hidden"></div>
            </div>
        </div>

        <!-- Title and Add Book Button -->
        <div class="flex items-center justify-between mb-8 slide-down" style="flex-wrap: wrap; gap: 1rem;">
            <div class="flex items-center gap-3">
                <div class="icon-box">
                    <svg class="text-white" width="36" height="36" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
                    </svg>
                </div>
                <h1 class="title">My Reading Journey</h1>
            </div>
            <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                <button id="syncBtn" onclick="syncNow()" class="btn" style="background: linear-gradient(to right, #60a5fa, #c084fc); color: white; padding: 0.75rem 1.5rem;">
                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                    </svg>
                    <span id="syncStatus">Sync</span>
                </button>
                <button onclick="toggleAddForm()" class="btn btn-primary">
                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                    </svg>
                    Add Book
                </button>
            </div>
        </div>

        <!-- Supabase Setup Banner -->
        <div id="setupBanner" class="card mb-8" style="background: linear-gradient(to right, #fef3c7, #fed7aa); border-left: 4px solid #f59e0b;">
            <div class="flex items-center gap-3" style="flex-wrap: wrap;">
                <svg style="color: #f59e0b; min-width: 24px;" width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                <div style="flex: 1;">
                    <h3 class="font-bold text-gray-800">Supabase Setup Required</h3>
                    <p class="text-sm text-gray-600 mt-1">Enter your Supabase credentials to enable cloud sync across devices.</p>
                    <div class="grid grid-cols-1 gap-3 mt-3" style="max-width: 600px;">
                        <input type="text" id="supabaseUrl" placeholder="Supabase URL (https://xxxxx.supabase.co)" class="input text-sm">
                        <input type="text" id="supabaseKey" placeholder="Supabase Anon Key" class="input text-sm">
                        <input type="text" id="userId" placeholder="Your Unique User ID (e.g., your email or name)" class="input text-sm">
                        <button onclick="saveSupabaseConfig()" class="btn btn-primary" style="width: fit-content;">Save & Connect</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Add Book Form -->
        <div id="addBookForm" class="card mb-8 hidden slide-down">
            <h2 class="text-2xl font-bold gradient-text mb-4">Add New Book</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                <input type="text" id="bookTitle" placeholder="Title" class="input">
                <input type="text" id="bookAuthor" placeholder="Author" class="input">
                <input type="text" id="bookGenre" placeholder="Genre" class="input">
                <select id="bookFormat" class="input" style="cursor: pointer;">
                    <option value="Paperback">Paperback</option>
                    <option value="Hardcover">Hardcover</option>
                    <option value="E-book">E-book</option>
                    <option value="Audiobook">Audiobook</option>
                </select>
            </div>
            <button onclick="addBook()" class="btn btn-primary">Add Book</button>
        </div>

        <!-- Stats Section -->
        <div class="grid grid-cols-2 md:grid-cols-3 gap-4 mb-8" id="statsSection"></div>

        <!-- Reading Calendar -->
        <div class="card mb-8 fade-in">
            <div class="flex items-center justify-between mb-6" style="flex-wrap: wrap; gap: 1rem;">
                <h2 class="text-2xl font-bold gradient-text">Reading Calendar</h2>
                <div class="flex items-center gap-3">
                    <button onclick="changeMonth(-1)" class="p-2 rounded-full bg-purple-100 cursor-pointer" style="border: none; cursor: pointer;">
                        <svg class="text-purple-600" style="width: 20px; height: 20px;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                        </svg>
                    </button>
                    <span id="currentMonthLabel" class="font-bold text-gray-800 text-center min-w-150"></span>
                    <button onclick="changeMonth(1)" class="p-2 rounded-full bg-purple-100 cursor-pointer" style="border: none; cursor: pointer;">
                        <svg class="text-purple-600" style="width: 20px; height: 20px;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                        </svg>
                    </button>
                </div>
            </div>
            
            <div id="calendar" class="grid grid-cols-7 gap-2"></div>
            
            <div class="flex items-center justify-center gap-6 mt-6 text-sm" style="flex-wrap: wrap;">
                <div class="flex items-center gap-2">
                    <div style="width: 1rem; height: 1rem; border-radius: 0.25rem; background: linear-gradient(to bottom right, #4ade80, #10b981);"></div>
                    <span class="text-gray-600 font-medium">Read (Click to toggle)</span>
                </div>
                <div class="flex items-center gap-2">
                    <div style="width: 1rem; height: 1rem; border-radius: 0.25rem; background: linear-gradient(to bottom right, #c084fc, #f472b6);"></div>
                    <span class="text-gray-600 font-medium">Today</span>
                </div>
                <div class="flex items-center gap-2">
                    <div style="width: 1rem; height: 1rem; border-radius: 0.25rem;" class="bg-gray-100"></div>
                    <span class="text-gray-600 font-medium">No Reading</span>
                </div>
            </div>
        </div>

        <!-- All Books List -->
        <div class="card mb-8 fade-in">
            <h2 class="text-2xl font-bold gradient-text mb-4">All Books</h2>
            <div id="allBooksList"></div>
        </div>
    </div>

    <script>
        // Supabase configuration
        let supabase = null;
        let userId = localStorage.getItem('readingDashboard_userId') || '';
        
        // Initialize Supabase if credentials exist
        const storedUrl = localStorage.getItem('readingDashboard_supabaseUrl');
        const storedKey = localStorage.getItem('readingDashboard_supabaseKey');
        
        if (storedUrl && storedKey && userId) {
            try {
                supabase = window.supabase.createClient(storedUrl, storedKey);
                document.getElementById('setupBanner').style.display = 'none';
            } catch (e) {
                console.error('Supabase init error:', e);
            }
        }

        // Load data from localStorage or use defaults
        let books = JSON.parse(localStorage.getItem('readingDashboard_books')) || [
            { id: 1, title: "The Midnight Library", author: "Matt Haig", status: "completed", genre: "Fiction", format: "Paperback", startDate: "2024-11-01", finishDate: "2024-11-15" },
            { id: 2, title: "Atomic Habits", author: "James Clear", status: "reading", genre: "Self-Help", format: "E-book", startDate: "2024-12-01", finishDate: "" },
            { id: 3, title: "Project Hail Mary", author: "Andy Weir", status: "tbr", genre: "Science Fiction", format: "Audiobook", startDate: "", finishDate: "" }
        ];
        
        let readDates = new Set(JSON.parse(localStorage.getItem('readingDashboard_readDates')) || []);
        let currentMonth = new Date();
        let activeTab = null;
        let isSyncing = false;

        // Save Supabase configuration
        function saveSupabaseConfig() {
            const url = document.getElementById('supabaseUrl').value.trim();
            const key = document.getElementById('supabaseKey').value.trim();
            const user = document.getElementById('userId').value.trim();

            if (!url || !key || !user) {
                alert('Please fill in all fields');
                return;
            }

            try {
                supabase = window.supabase.createClient(url, key);
                userId = user;
                
                localStorage.setItem('readingDashboard_supabaseUrl', url);
                localStorage.setItem('readingDashboard_supabaseKey', key);
                localStorage.setItem('readingDashboard_userId', user);
                
                document.getElementById('setupBanner').style.display = 'none';
                
                // Initial sync
                syncNow();
            } catch (e) {
                alert('Error connecting to Supabase: ' + e.message);
            }
        }

        // Sync data to Supabase
        async function syncToCloud() {
            if (!supabase || !userId || isSyncing) return;
            
            try {
                const { data, error } = await supabase
                    .from('reading_data')
                    .upsert({
                        user_id: userId,
                        books: books,
                        read_dates: [...readDates],
                        updated_at: new Date().toISOString()
                    }, {
                        onConflict: 'user_id'
                    });

                if (error) throw error;
                return true;
            } catch (e) {
                console.error('Sync to cloud error:', e);
                return false;
            }
        }

        // Load data from Supabase
        async function syncFromCloud() {
            if (!supabase || !userId || isSyncing) return;
            
            try {
                const { data, error } = await supabase
                    .from('reading_data')
                    .select('*')
                    .eq('user_id', userId)
                    .single();

                if (error) {
                    if (error.code === 'PGRST116') {
                        // No data found, sync current data to cloud
                        await syncToCloud();
                        return true;
                    }
                    throw error;
                }

                if (data) {
                    books = data.books || books;
                    readDates = new Set(data.read_dates || []);
                    saveDataLocally();
                    renderAll();
                    return true;
                }
            } catch (e) {
                console.error('Sync from cloud error:', e);
                return false;
            }
        }

        // Manual sync button
        async function syncNow() {
            if (!supabase || !userId) {
                alert('Please configure Supabase first');
                return;
            }

            if (isSyncing) return;
            
            isSyncing = true;
            const syncBtn = document.getElementById('syncStatus');
            const originalText = syncBtn.textContent;
            syncBtn.textContent = 'Syncing...';

            try {
                // First, get cloud data
                const cloudSuccess = await syncFromCloud();
                
                // Then push local changes
                if (cloudSuccess) {
                    await syncToCloud();
                    syncBtn.textContent = 'Synced âœ“';
                    setTimeout(() => {
                        syncBtn.textContent = originalText;
                    }, 2000);
                } else {
                    syncBtn.textContent = 'Sync Failed';
                    setTimeout(() => {
                        syncBtn.textContent = originalText;
                    }, 2000);
                }
            } catch (e) {
                syncBtn.textContent = 'Sync Failed';
                setTimeout(() => {
                    syncBtn.textContent = originalText;
                }, 2000);
            } finally {
                isSyncing = false;
            }
        }

        // Auto-sync when data changes
        async function saveData() {
            saveDataLocally();
            if (supabase && userId) {
                await syncToCloud();
            }
        }

        // Save to localStorage
        function saveDataLocally() {
            localStorage.setItem('readingDashboard_books', JSON.stringify(books));
            localStorage.setItem('readingDashboard_readDates', JSON.stringify([...readDates]));
        }

        // Load from cloud on page load
        if (supabase && userId) {
            syncFromCloud();
        }

        function toggleAddForm() {
            const form = document.getElementById('addBookForm');
            form.classList.toggle('hidden');
        }

        function addBook() {
            const title = document.getElementById('bookTitle').value;
            const author = document.getElementById('bookAuthor').value;
            const genre = document.getElementById('bookGenre').value;
            const format = document.getElementById('bookFormat').value;

            if (!title || !author) return;

            books.push({
                id: Date.now(),
                title, author, genre, format,
                status: 'tbr',
                startDate: '',
                finishDate: ''
            });

            document.getElementById('bookTitle').value = '';
            document.getElementById('bookAuthor').value = '';
            document.getElementById('bookGenre').value = '';
            toggleAddForm();
            saveData();
            renderAll();
        }

        function deleteBook(id) {
            books = books.filter(b => b.id !== id);
            saveData();
            renderAll();
        }

        function updateBook(id, field, value) {
            const book = books.find(b => b.id === id);
            if (book) book[field] = value;
            saveData();
            renderAll();
        }

        function toggleTab(tab) {
            if (activeTab === tab) {
                activeTab = null;
            } else {
                activeTab = tab;
            }
            renderTabs();
        }

        function renderTabs() {
            const tabs = ['reading', 'tbr', 'completed'];
            tabs.forEach(tab => {
                const tabEl = document.getElementById(`${tab}Tab`);
                const listEl = document.getElementById(`${tab}List`);
                
                if (activeTab === tab) {
                    tabEl.className = 'tab-btn active-' + tab;
                    listEl.classList.remove('hidden');
                    
                    const filteredBooks = books.filter(b => b.status === tab);
                    listEl.innerHTML = filteredBooks.length === 0 
                        ? '<p class="text-gray-600 italic text-center py-8 font-medium">No books in this category</p>'
                        : filteredBooks.map((book, i) => renderBookCard(book, i)).join('');
                } else {
                    tabEl.className = 'tab-btn inactive';
                    listEl.classList.add('hidden');
                }
            });
            updateCounts();
        }

        function updateCounts() {
            document.getElementById('readingCount').textContent = `${books.filter(b => b.status === 'reading').length} ${books.filter(b => b.status === 'reading').length === 1 ? 'book' : 'books'}`;
            document.getElementById('tbrCount').textContent = `${books.filter(b => b.status === 'tbr').length} ${books.filter(b => b.status === 'tbr').length === 1 ? 'book' : 'books'}`;
            document.getElementById('completedCount').textContent = `${books.filter(b => b.status === 'completed').length} ${books.filter(b => b.status === 'completed').length === 1 ? 'book' : 'books'}`;
        }

        function renderBookCard(book, index) {
            const statusOptions = ['tbr', 'reading', 'completed'];
            return `
                <div class="book-card">
                    <div class="flex justify-between items-start mb-3">
                        <div style="flex: 1;">
                            <h3 class="font-bold text-gray-800 text-lg">${book.title}</h3>
                            <p class="text-sm text-gray-600 mt-1">${book.author}</p>
                        </div>
                        <button onclick="deleteBook(${book.id})" class="delete-btn">
                            <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                            </svg>
                        </button>
                    </div>
                    <div class="space-y-2 text-sm">
                        <div class="flex gap-2">
                            <span class="text-gray-600 font-medium">Status:</span>
                            <select onchange="updateBook(${book.id}, 'status', this.value)" class="text-sm font-medium text-purple-600" style="border: none; background: transparent; cursor: pointer;">
                                ${statusOptions.map(s => `<option value="${s}" ${book.status === s ? 'selected' : ''}>${s === 'tbr' ? 'TBR' : s === 'reading' ? 'Reading' : 'Completed'}</option>`).join('')}
                            </select>
                        </div>
                        <div class="flex gap-2">
                            <span class="text-gray-600 font-medium">Genre:</span>
                            <input type="text" value="${book.genre}" onchange="updateBook(${book.id}, 'genre', this.value)" class="text-sm" style="flex: 1; border: none; background: transparent;" placeholder="Genre">
                        </div>
                        ${book.status !== 'tbr' ? `
                        <div class="flex gap-2" style="align-items: center;">
                            <span class="text-gray-600 font-medium">Started:</span>
                            <input type="date" value="${book.startDate}" onchange="updateBook(${book.id}, 'startDate', this.value)" class="text-sm" style="border: 1px solid #e9d5ff; border-radius: 0.75rem; padding: 0.25rem 0.75rem;">
                        </div>
                        ` : ''}
                        ${book.status === 'completed' ? `
                        <div class="flex gap-2" style="align-items: center;">
                            <span class="text-gray-600 font-medium">Finished:</span>
                            <input type="date" value="${book.finishDate}" onchange="updateBook(${book.id}, 'finishDate', this.value)" class="text-sm" style="border: 1px solid #e9d5ff; border-radius: 0.75rem; padding: 0.25rem 0.75rem;">
                        </div>
                        ` : ''}
                    </div>
                </div>
            `;
        }

        function renderStats() {
            const now = new Date();
            const completed = books.filter(b => b.status === 'completed');
            
            const yearCount = completed.filter(b => b.finishDate && new Date(b.finishDate) >= new Date(now.getFullYear(), 0, 1)).length;
            const monthCount = completed.filter(b => b.finishDate && new Date(b.finishDate) >= new Date(now.getFullYear(), now.getMonth(), 1)).length;
            const weekStart = new Date(now);
            weekStart.setDate(now.getDate() - now.getDay());
            const weekCount = completed.filter(b => b.finishDate && new Date(b.finishDate) >= weekStart).length;

            const streaks = calculateStreaks();

            const stats = [
                { label: 'This Year', value: yearCount, color: 'purple', iconColor: '#c084fc', icon: 'M13 7h8m0 0v8m0-8l-8 8-4-4-6 6' },
                { label: 'This Month', value: monthCount, color: 'blue', iconColor: '#60a5fa', icon: 'M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z' },
                { label: 'This Week', value: weekCount, color: 'pink', iconColor: '#f472b6', icon: 'M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253' },
                { label: 'Total Completed', value: completed.length, color: 'red', iconColor: '#f87171', icon: 'M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253' },
                { label: 'Current Streak', value: streaks.current, color: 'orange', iconColor: '#fb923c', icon: 'M13 10V3L4 14h7v7l9-11h-7z', suffix: streaks.current === 1 ? 'day' : 'days' },
                { label: 'Longest Streak', value: streaks.longest, color: 'emerald', iconColor: '#10b981', icon: 'M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z', suffix: streaks.longest === 1 ? 'day' : 'days' }
            ];

            document.getElementById('statsSection').innerHTML = stats.map((stat, i) => `
                <div class="stat-card ${stat.color}" style="animation: fadeInUp 0.5s ease-out forwards; animation-delay: ${i * 0.1}s; opacity: 0;">
                    <div class="flex flex-col items-center text-center gap-2">
                        <svg style="color: ${stat.iconColor};" width="32" height="32" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="${stat.icon}"></path>
                        </svg>
                        <p class="text-gray-600 text-sm font-medium">${stat.label}</p>
                        <p class="text-4xl font-bold" style="background: linear-gradient(to right, ${stat.iconColor}, ${stat.iconColor}cc); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">${stat.value}</p>
                        ${stat.suffix ? `<p style="font-size: 0.75rem;" class="text-gray-600">${stat.suffix}</p>` : ''}
                    </div>
                </div>
            `).join('');
        }

        function calculateStreaks() {
            const allDates = new Set([...readDates]);
            
            // Only add dates from manually marked readDates
            // Don't include book dates to start from 0
            
            if (allDates.size === 0) return { current: 0, longest: 0 };
            
            const sortedDates = Array.from(allDates).sort();
            let currentStreak = 0, longestStreak = 0, tempStreak = 1;
            const today = new Date().toISOString().split('T')[0];
            const yesterday = new Date(Date.now() - 86400000).toISOString().split('T')[0];
            
            // Calculate longest streak
            for (let i = 1; i < sortedDates.length; i++) {
                const diffDays = Math.floor((new Date(sortedDates[i]) - new Date(sortedDates[i - 1])) / 86400000);
                if (diffDays === 1) {
                    tempStreak++;
                } else {
                    longestStreak = Math.max(longestStreak, tempStreak);
                    tempStreak = 1;
                }
            }
            longestStreak = Math.max(longestStreak, tempStreak);
            
            // Calculate current streak
            if (sortedDates.includes(today) || sortedDates.includes(yesterday)) {
                currentStreak = 1;
                let checkDate = sortedDates.includes(today) ? today : yesterday;
                let dateIndex = sortedDates.indexOf(checkDate);
                for (let i = dateIndex - 1; i >= 0; i--) {
                    const diffDays = Math.floor((new Date(sortedDates[i + 1]) - new Date(sortedDates[i])) / 86400000);
                    if (diffDays === 1) currentStreak++;
                    else break;
                }
            }
            return { current: currentStreak, longest: longestStreak };
        }

        function renderCalendar() {
            const year = currentMonth.getFullYear();
            const month = currentMonth.getMonth();
            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            
            document.getElementById('currentMonthLabel').textContent = currentMonth.toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
            
            let html = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'].map(day => 
                `<div class="text-center font-bold text-gray-600 text-sm py-2">${day}</div>`
            ).join('');
            
            for (let i = 0; i < firstDay; i++) {
                html += '<div style="aspect-ratio: 1;"></div>';
            }
            
            for (let day = 1; day <= daysInMonth; day++) {
                const date = new Date(year, month, day);
                const dateStr = date.toISOString().split('T')[0];
                
                // Check if manually marked as read
                const hasRead = readDates.has(dateStr);
                
                // Check if from book activity (shows green but doesn't affect streak)
                const hasBookActivity = books.some(book => {
                    if (book.status === 'completed' && book.finishDate === dateStr) return true;
                    if (book.status === 'reading' && book.startDate) {
                        const start = new Date(book.startDate);
                        const end = book.finishDate ? new Date(book.finishDate) : new Date();
                        return date >= start && date <= end;
                    }
                    return false;
                });
                
                const isToday = new Date().toDateString() === date.toDateString();
                
                // Show green if manually marked OR has book activity
                const showAsRead = hasRead || hasBookActivity;
                
                html += `<button onclick="toggleReadDate('${dateStr}')" class="calendar-day ${
                    isToday ? 'today' : showAsRead ? 'read' : 'empty'
                }">${day}</button>`;
            }
            
            document.getElementById('calendar').innerHTML = html;
        }

        function toggleReadDate(dateStr) {
            if (readDates.has(dateStr)) {
                readDates.delete(dateStr);
            } else {
                readDates.add(dateStr);
            }
            saveData();
            renderAll();
        }

        function changeMonth(delta) {
            currentMonth = new Date(currentMonth.getFullYear(), currentMonth.getMonth() + delta, 1);
            renderCalendar();
        }

        function renderAllBooks() {
            if (books.length === 0) {
                document.getElementById('allBooksList').innerHTML = '<p class="text-gray-600 italic text-center py-4">No books added yet</p>';
                return;
            }
            
            document.getElementById('allBooksList').innerHTML = books.map((book, i) => `
                <div class="all-books-item" style="animation: fadeInUp 0.4s ease-out forwards; animation-delay: ${i * 0.05}s; opacity: 0;">
                    <div style="flex: 1;">
                        <h3 class="font-semibold text-gray-800">${book.title}</h3>
                        <p class="text-sm text-gray-600">${book.author}</p>
                    </div>
                    <span class="status-badge ${
                        book.status === 'reading' ? 'gradient-purple-pink' :
                        book.status === 'tbr' ? 'gradient-blue-purple' :
                        'gradient-pink-red'
                    }">
                        ${book.status === 'reading' ? 'Currently Reading' : book.status === 'tbr' ? 'To Be Read' : 'Completed'}
                    </span>
                </div>
            `).join('');
        }

        function renderAll() {
            renderTabs();
            renderStats();
            renderCalendar();
            renderAllBooks();
        }

        renderAll();
    </script>
</body>
</html>
